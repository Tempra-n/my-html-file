<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude√ó3D „Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„É´„Éº„É†Ë®≠Ë®à</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            height: 100vh;
        }
        
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            border-right: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .panel-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .input-group {
            margin-bottom: 12px;
        }
        
        .input-label {
            display: block;
            font-size: 0.9em;
            color: #555;
            margin-bottom: 5px;
        }
        
        .input-field {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        .input-field:focus {
            border-color: #667eea;
            outline: none;
        }
        
        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: transform 0.2s ease;
            width: 100%;
            margin-bottom: 8px;
        }
        
        .button:hover {
            transform: scale(1.02);
        }
        
        .button.secondary {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
        }
        
        .button.danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }
        
        .viewer-container {
            position: relative;
            background: #1a1a1a;
            overflow: hidden;
        }
        
        #roomViewer {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .viewer-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            color: white;
        }
        
        .control-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin: 2px;
            font-size: 0.8em;
        }
        
        .control-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .furniture-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }
        
        .furniture-item {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }
        
        .furniture-item:hover {
            border-color: #667eea;
            background: #e7f1ff;
        }
        
        .furniture-item.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .claude-chat {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.85em;
            line-height: 1.4;
        }
        
        .chat-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
            margin-top: 8px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .stat-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: #666;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.2em;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .layout-preset {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 8px;
            margin: 5px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }
        
        .layout-preset:hover {
            border-color: #667eea;
            background: #f0f8ff;
        }
        
        .notification {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div class="main-container">
        <div class="control-panel">
            <h2 class="panel-title">üè† „É´„Éº„É†Ë®≠Ë®à„Ç∑„Çπ„ÉÜ„É†</h2>
            
            <!-- ÈÉ®Â±ãË®≠ÂÆö -->
            <div class="section">
                <div class="section-title">üìê ÈÉ®Â±ã„ÅÆÂü∫Êú¨Ë®≠ÂÆö</div>
                <div class="input-group">
                    <label class="input-label">ÂπÖ (m)</label>
                    <input type="number" class="input-field" id="roomWidth" value="4" min="2" max="10" step="0.1">
                </div>
                <div class="input-group">
                    <label class="input-label">Â••Ë°å„Åç (m)</label>
                    <input type="number" class="input-field" id="roomDepth" value="3" min="2" max="10" step="0.1">
                </div>
                <div class="input-group">
                    <label class="input-label">È´ò„Åï (m)</label>
                    <input type="number" class="input-field" id="roomHeight" value="2.4" min="2" max="4" step="0.1">
                </div>
                <button class="button" onclick="updateRoom()">üèóÔ∏è ÈÉ®Â±ã„ÇíÊõ¥Êñ∞</button>
            </div>
            
            <!-- ÂÆ∂ÂÖ∑ËøΩÂä† -->
            <div class="section">
                <div class="section-title">ü™ë ÂÆ∂ÂÖ∑„ÅÆËøΩÂä†</div>
                <div class="furniture-grid">
                    <div class="furniture-item" onclick="addFurniture('bed')">
                        üõèÔ∏è<br>„Éô„ÉÉ„Éâ
                    </div>
                    <div class="furniture-item" onclick="addFurniture('desk')">
                        üóÑÔ∏è<br>„Éá„Çπ„ÇØ
                    </div>
                    <div class="furniture-item" onclick="addFurniture('chair')">
                        ü™ë<br>Ê§ÖÂ≠ê
                    </div>
                    <div class="furniture-item" onclick="addFurniture('bookshelf')">
                        üìö<br>Êú¨Ê£ö
                    </div>
                    <div class="furniture-item" onclick="addFurniture('wardrobe')">
                        üëî<br>„ÇØ„É≠„Éº„Çº„ÉÉ„Éà
                    </div>
                    <div class="furniture-item" onclick="addFurniture('sofa')">
                        üõãÔ∏è<br>„ÇΩ„Éï„Ç°
                    </div>
                </div>
                <button class="button danger" onclick="clearFurniture()">üóëÔ∏è ÂÖ®„Å¶ÂâäÈô§</button>
            </div>
            
            <!-- „É¨„Ç§„Ç¢„Ç¶„Éà„Éó„É™„Çª„ÉÉ„Éà -->
            <div class="section">
                <div class="section-title">‚ú® „É¨„Ç§„Ç¢„Ç¶„Éà„Éó„É™„Çª„ÉÉ„Éà</div>
                <div class="layout-preset" onclick="applyLayout('study')">
                    üìñ ÂãâÂº∑ÈÉ®Â±ã„É¨„Ç§„Ç¢„Ç¶„Éà
                </div>
                <div class="layout-preset" onclick="applyLayout('bedroom')">
                    üõèÔ∏è ÂØùÂÆ§„É¨„Ç§„Ç¢„Ç¶„Éà
                </div>
                <div class="layout-preset" onclick="applyLayout('workspace')">
                    üíª „ÉØ„Éº„ÇØ„Çπ„Éö„Éº„Çπ
                </div>
                <div class="layout-preset" onclick="applyLayout('minimal')">
                    üåø „Éü„Éã„Éû„É´„Çπ„Çø„Ç§„É´
                </div>
            </div>
            
            <!-- Claude AIÁõ∏Ë´á -->
            <div class="section">
                <div class="section-title">ü§ñ Claude AI Áõ∏Ë´á</div>
                <div class="claude-chat" id="claudeChat">
                    <div style="color: #667eea; font-weight: bold;">Claude:</div>
                    <div>„Åì„Çì„Å´„Å°„ÅØÔºÅÈÉ®Â±ã„ÅÆ„É¨„Ç§„Ç¢„Ç¶„Éà„Å´„Å§„ÅÑ„Å¶‰Ωï„Åß„ÇÇ„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑ„ÄÇ„Äå„ÇÇ„Å£„Å®Â∫É„ÅèË¶ã„Åõ„Åü„ÅÑ„Äç„ÄåÂèéÁ¥ç„ÇíÂ¢ó„ÇÑ„Åó„Åü„ÅÑ„Äç„Å™„Å©„ÄÅ„ÅäÊ∞óËªΩ„Å´„Å©„ÅÜ„Åû„ÄÇ</div>
                </div>
                <input type="text" class="chat-input" id="claudeInput" placeholder="‰æãÔºö„ÇÇ„Å£„Å®ÈñãÊîæÊÑü„ÅÆ„ÅÇ„ÇãÈÖçÁΩÆ„Å´„Åó„Åü„ÅÑ..." onkeypress="handleChatEnter(event)">
                <button class="button secondary" onclick="sendToClaude()">üí¨ Áõ∏Ë´á„Åô„Çã</button>
            </div>
            
            <!-- Á©∫ÈñìÂàÜÊûê -->
            <div class="section">
                <div class="section-title">üìä Á©∫ÈñìÂàÜÊûê</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="utilizationRate">75%</div>
                        <div class="stat-label">Âà©Áî®Áéá</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="walkingDistance">3.2m</div>
                        <div class="stat-label">Âπ≥ÂùáÂãïÁ∑ö</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="openSpace">40%</div>
                        <div class="stat-label">ÈñãÊîæÊÑü</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="efficiency">B+</div>
                        <div class="stat-label">ÂäπÁéáÊÄß</div>
                    </div>
                </div>
                <button class="button secondary" onclick="analyzeSpace()">üîÑ ÂÜçÂàÜÊûê</button>
            </div>
            
            <!-- „Ç®„ÇØ„Çπ„Éù„Éº„Éà -->
            <div class="section">
                <div class="section-title">üíæ „Ç®„ÇØ„Çπ„Éù„Éº„Éà</div>
                <button class="button" onclick="exportToBlender()">üì§ Blender„Ç≥„Éº„ÉâÁîüÊàê</button>
                <button class="button secondary" onclick="saveLayout()">üíø „É¨„Ç§„Ç¢„Ç¶„Éà‰øùÂ≠ò</button>
                <button class="button secondary" onclick="takeScreenshot()">üì∏ „Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà</button>
            </div>
        </div>
        
        <div class="viewer-container">
            <canvas id="roomViewer"></canvas>
            
            <div class="viewer-controls">
                <div style="margin-bottom: 10px; font-weight: bold;">üéÆ Êìç‰Ωú</div>
                <button class="control-button" onclick="resetCamera()">üéØ Ë¶ñÁÇπ„É™„Çª„ÉÉ„Éà</button>
                <button class="control-button" onclick="toggleWireframe()">üî≤ „ÉØ„Ç§„É§„Éº„Éï„É¨„Éº„É†</button>
                <button class="control-button" onclick="toggleGrid()">üìê „Ç∞„É™„ÉÉ„Éâ</button>
                <div style="margin-top: 10px; font-size: 0.8em; opacity: 0.8;">
                    „Éû„Ç¶„Çπ: ÂõûËª¢„ÉªÁßªÂãï<br>
                    „Éõ„Ç§„Éº„É´: „Ç∫„Éº„É†<br>
                    ÂÆ∂ÂÖ∑: „ÇØ„É™„ÉÉ„ÇØ„ÅßÈÅ∏Êäû
                </div>
            </div>
            
            <div class="loading" id="loadingIndicator" style="display: none;">
                <div class="spinner"></div>
                <div>3D„Ç∑„Éº„É≥„ÇíÊßãÁØâ‰∏≠...</div>
            </div>
            
            <div class="notification" id="notification"></div>
        </div>
    </div>
    
    <script>
        // Three.js „Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
        let scene, camera, renderer, controls;
        let room, furniture = [];
        let selectedObject = null;
        let roomWidth = 4, roomDepth = 3, roomHeight = 2.4;
        let showWireframe = false, showGrid = true;
        
        // ÂÆ∂ÂÖ∑„ÅÆÂÆöÁæ©
        const furnitureDefinitions = {
            bed: { width: 1.2, depth: 2.0, height: 0.3, color: 0x8B4513, name: '„Éô„ÉÉ„Éâ' },
            desk: { width: 1.2, depth: 0.6, height: 0.75, color: 0x654321, name: '„Éá„Çπ„ÇØ' },
            chair: { width: 0.5, depth: 0.5, height: 0.9, color: 0x2F4F4F, name: 'Ê§ÖÂ≠ê' },
            bookshelf: { width: 0.3, depth: 1.8, height: 2.0, color: 0x8B4513, name: 'Êú¨Ê£ö' },
            wardrobe: { width: 0.6, depth: 1.8, height: 2.0, color: 0x696969, name: '„ÇØ„É≠„Éº„Çº„ÉÉ„Éà' },
            sofa: { width: 0.8, depth: 1.8, height: 0.8, color: 0x4682B4, name: '„ÇΩ„Éï„Ç°' }
        };
        
        init();
        
        function init() {
            showLoading(true);
            
            // „Ç∑„Éº„É≥‰ΩúÊàê
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);
            
            // „Ç´„É°„É©‰ΩúÊàê
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(5, 4, 5);
            camera.lookAt(0, 0, 0);
            
            // „É¨„É≥„ÉÄ„É©„Éº‰ΩúÊàê
            const canvas = document.getElementById('roomViewer');
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // ÁÖßÊòéË®≠ÂÆö
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // „Ç∞„É™„ÉÉ„Éâ
            const gridHelper = new THREE.GridHelper(10, 10);
            gridHelper.name = 'grid';
            scene.add(gridHelper);
            
            // Á∞°Êòì„Ç≥„É≥„Éà„É≠„Éº„É´Ôºà„Éû„Ç¶„ÇπÊìç‰ΩúÔºâ
            setupControls();
            
            // ÂàùÊúüÈÉ®Â±ã‰ΩúÊàê
            createRoom();
            
            // „É¨„É≥„ÉÄ„É™„É≥„Ç∞„É´„Éº„Éó
            animate();
            
            showLoading(false);
            showNotification('3DÈÉ®Â±ãË®≠Ë®à„Ç∑„Çπ„ÉÜ„É†„ÅåÊ∫ñÂÇôÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ');
        }
        
        function setupControls() {
            let isMouseDown = false;
            let mouseX = 0, mouseY = 0;
            let targetX = 0, targetY = 0;
            let distance = 8;
            
            const canvas = document.getElementById('roomViewer');
            
            canvas.addEventListener('mousedown', (event) => {
                isMouseDown = true;
                mouseX = event.clientX;
                mouseY = event.clientY;
            });
            
            canvas.addEventListener('mousemove', (event) => {
                if (!isMouseDown) return;
                
                const deltaX = event.clientX - mouseX;
                const deltaY = event.clientY - mouseY;
                
                targetX += deltaX * 0.01;
                targetY += deltaY * 0.01;
                
                mouseX = event.clientX;
                mouseY = event.clientY;
                
                updateCameraPosition();
            });
            
            canvas.addEventListener('mouseup', () => {
                isMouseDown = false;
            });
            
            canvas.addEventListener('wheel', (event) => {
                distance += event.deltaY * 0.01;
                distance = Math.max(3, Math.min(15, distance));
                updateCameraPosition();
                event.preventDefault();
            });
            
            function updateCameraPosition() {
                camera.position.x = Math.cos(targetX) * distance;
                camera.position.z = Math.sin(targetX) * distance;
                camera.position.y = Math.max(1, distance * Math.sin(targetY * 0.5) + 3);
                camera.lookAt(0, 0, 0);
            }
        }
        
        function createRoom() {
            // Êó¢Â≠ò„ÅÆÈÉ®Â±ã„ÇíÂâäÈô§
            if (room) {
                scene.remove(room);
            }
            
            // ÈÉ®Â±ã„ÅÆ„Ç∞„É´„Éº„Éó‰ΩúÊàê
            room = new THREE.Group();
            
            // Â∫ä
            const floorGeometry = new THREE.PlaneGeometry(roomWidth, roomDepth);
            const floorMaterial = new THREE.MeshLambertMaterial({ color: 0xDEB887 });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            room.add(floor);
            
            // Â£Å
            const wallMaterial = new THREE.MeshLambertMaterial({ color: 0xF5F5DC });
            
            // ËÉåÈù¢„ÅÆÂ£Å
            const backWallGeometry = new THREE.PlaneGeometry(roomWidth, roomHeight);
            const backWall = new THREE.Mesh(backWallGeometry, wallMaterial);
            backWall.position.set(0, roomHeight/2, -roomDepth/2);
            room.add(backWall);
            
            // Â∑¶„ÅÆÂ£Å
            const leftWallGeometry = new THREE.PlaneGeometry(roomDepth, roomHeight);
            const leftWall = new THREE.Mesh(leftWallGeometry, wallMaterial);
            leftWall.position.set(-roomWidth/2, roomHeight/2, 0);
            leftWall.rotation.y = Math.PI / 2;
            room.add(leftWall);
            
            // Âè≥„ÅÆÂ£Å
            const rightWall = new THREE.Mesh(leftWallGeometry, wallMaterial);
            rightWall.position.set(roomWidth/2, roomHeight/2, 0);
            rightWall.rotation.y = -Math.PI / 2;
            room.add(rightWall);
            
            scene.add(room);
        }
        
        function addFurniture(type) {
            const def = furnitureDefinitions[type];
            if (!def) return;
            
            const geometry = new THREE.BoxGeometry(def.width, def.height, def.depth);
            const material = new THREE.MeshLambertMaterial({ color: def.color });
            const furnitureMesh = new THREE.Mesh(geometry, material);
            
            // „É©„É≥„ÉÄ„É†„Å™‰ΩçÁΩÆ„Å´ÈÖçÁΩÆÔºàÈÉ®Â±ã„ÅÆÁØÑÂõ≤ÂÜÖÔºâ
            const x = (Math.random() - 0.5) * (roomWidth - def.width);
            const z = (Math.random() - 0.5) * (roomDepth - def.depth);
            furnitureMesh.position.set(x, def.height/2, z);
            
            furnitureMesh.castShadow = true;
            furnitureMesh.receiveShadow = true;
            furnitureMesh.userData = { type: type, name: def.name };
            
            scene.add(furnitureMesh);
            furniture.push(furnitureMesh);
            
            showNotification(`${def.name}„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`);
            updateStats();
        }
        
        function clearFurniture() {
            furniture.forEach(item => scene.remove(item));
            furniture = [];
            selectedObject = null;
            showNotification('ÂÆ∂ÂÖ∑„Çí„Åô„Åπ„Å¶ÂâäÈô§„Åó„Åæ„Åó„Åü');
            updateStats();
        }
        
        function updateRoom() {
            roomWidth = parseFloat(document.getElementById('roomWidth').value);
            roomDepth = parseFloat(document.getElementById('roomDepth').value);
            roomHeight = parseFloat(document.getElementById('roomHeight').value);
            
            createRoom();
            showNotification('ÈÉ®Â±ã„ÅÆ„Çµ„Ç§„Ç∫„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü');
            updateStats();
        }
        
        function applyLayout(layoutType) {
            clearFurniture();
            
            const layouts = {
                study: [
                    { type: 'desk', x: 1, z: -1 },
                    { type: 'chair', x: 1, z: -0.3 },
                    { type: 'bookshelf', x: -1.5, z: -1 },
                    { type: 'bed', x: -0.5, z: 1 }
                ],
                bedroom: [
                    { type: 'bed', x: 0, z: -0.5 },
                    { type: 'wardrobe', x: -1.5, z: 1 },
                    { type: 'desk', x: 1.2, z: 0.8 },
                    { type: 'chair', x: 1.2, z: 0.3 }
                ],
                workspace: [
                    { type: 'desk', x: 0, z: -1 },
                    { type: 'chair', x: 0, z: -0.3 },
                    { type: 'bookshelf', x: -1.5, z: 0 },
                    { type: 'bookshelf', x: 1.5, z: 0 }
                ],
                minimal: [
                    { type: 'bed', x: -1, z: 0 },
                    { type: 'desk', x: 1, z: -0.5 },
                    { type: 'chair', x: 1, z: 0.2 }
                ]
            };
            
            const layout = layouts[layoutType];
            if (layout) {
                layout.forEach(item => {
                    const def = furnitureDefinitions[item.type];
                    const geometry = new THREE.BoxGeometry(def.width, def.height, def.depth);
                    const material = new THREE.MeshLambertMaterial({ color: def.color });
                    const furnitureMesh = new THREE.Mesh(geometry, material);
                    
                    furnitureMesh.position.set(item.x, def.height/2, item.z);
                    furnitureMesh.castShadow = true;
                    furnitureMesh.receiveShadow = true;
                    furnitureMesh.userData = { type: item.type, name: def.name };
                    
                    scene.add(furnitureMesh);
                    furniture.push(furnitureMesh);
                });
                
                showNotification(`${layoutType}„É¨„Ç§„Ç¢„Ç¶„Éà„ÇíÈÅ©Áî®„Åó„Åæ„Åó„Åü`);
                updateStats();
            }
        }
        
        function sendToClaude() {
            const input = document.getElementById('claudeInput');
            const chat = document.getElementById('claudeChat');
            const userMessage = input.value.trim();
            
            if (!userMessage) return;
            
            // „É¶„Éº„Ç∂„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
            chat.innerHTML += `<div style="margin-top: 10px;"><strong>„ÅÇ„Å™„Åü:</strong> ${userMessage}</div>`;
            
            // Claude „ÅÆÂøúÁ≠î„Çí„Ç∑„Éü„É•„É¨„Éº„Éà
            setTimeout(() => {
                const responses = [
                    "„Åù„ÅÆ„Ç¢„Ç§„Éá„Ç¢„ÅØÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅ„Éô„ÉÉ„Éâ„ÇíÁ™ìÈöõ„Å´ÁßªÂãï„Åô„Çã„Å®„ÄÅËá™ÁÑ∂ÂÖâ„ÇíÊúâÂäπÊ¥ªÁî®„Åß„Åç„Åæ„Åô„ÄÇË©¶„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÅãÔºü",
                    "ÂèéÁ¥ç„ÇíÂ¢ó„ÇÑ„Åô„Å™„Çâ„ÄÅÁ∏¶Âûã„ÅÆÂÆ∂ÂÖ∑„ÇíÊ¥ªÁî®„Åô„Çã„ÅÆ„Åå„Åä„Åô„Åô„ÇÅ„Åß„Åô„ÄÇÊú¨Ê£ö„ÇÑ„ÇØ„É≠„Éº„Çº„ÉÉ„Éà„ÇíÂ£ÅÈöõ„Å´ÈÖçÁΩÆ„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
                    "ÂãïÁ∑ö„ÇíÊîπÂñÑ„Åô„Çã„Å´„ÅØ„ÄÅ„Çà„Åè‰Ωø„ÅÜÂÆ∂ÂÖ∑„ÅÆÈñì„Å´ÂçÅÂàÜ„Å™„Çπ„Éö„Éº„Çπ„ÇíÁ¢∫‰øù„Åô„Çã„Åì„Å®„ÅåÈáçË¶Å„Åß„Åô„ÄÇÁèæÂú®„ÅÆÈÖçÁΩÆ„ÇíÂàÜÊûê„Åó„Å¶„Åø„Åæ„Åô„Å≠„ÄÇ",
                    "ÈñãÊîæÊÑü„ÇíÂá∫„Åô„Å´„ÅØ„ÄÅÈÉ®Â±ã„ÅÆ‰∏≠Â§Æ„Å´Â§ß„Åç„Å™ÂÆ∂ÂÖ∑„ÇíÁΩÆ„Åã„Å™„ÅÑ„Åì„Å®„Åå„Éù„Ç§„É≥„Éà„Åß„Åô„ÄÇÂ£ÅÈöõÈÖçÁΩÆ„ÇíË©¶„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
                    "‰ΩúÊ•≠ÂäπÁéá„Çí‰∏ä„Åí„Çã„Å™„Çâ„ÄÅ„Éá„Çπ„ÇØ„ÇíËá™ÁÑ∂ÂÖâ„ÅÆÂÖ•„ÇãÂ†¥ÊâÄ„Å´ÈÖçÁΩÆ„Åó„ÄÅÂøÖË¶Å„Å™Áâ©„ÇíÊâã„ÅÆÂ±ä„ÅèÁØÑÂõ≤„Å´ÁΩÆ„Åè„ÅÆ„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ"
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                chat.innerHTML += `<div style="margin-top: 10px;"><strong style="color: #667eea;">Claude:</strong> ${randomResponse}</div>`;
                chat.scrollTop = chat.scrollHeight;
            }, 1000);
            
            input.value = '';
            chat.scrollTop = chat.scrollHeight;
        }
        
        function handleChatEnter(event) {
            if (event.key === 'Enter') {
                sendToClaude();
            }
        }
        
        function updateStats() {
            // Á∞°ÊòìÁöÑ„Å™Áµ±Ë®àË®àÁÆó
            const totalArea = roomWidth * roomDepth;
            const usedArea = furniture.reduce((sum, item) => {
                const def = furnitureDefinitions[item.userData.type];
                return sum + (def.width * def.depth);
            }, 0);
            
            const utilizationRate = Math.round((usedArea / totalArea) * 100);
            const walkingDistance = (furniture.length * 0.5 + 2).toFixed(1);
            const openSpace = Math.max(0, 100 - utilizationRate);
            
            document.getElementById('utilizationRate').textContent = utilizationRate + '%';
            document.getElementById('walkingDistance').textContent = walkingDistance + 'm';
            document.getElementById('openSpace').textContent = openSpace + '%';
            
            // ÂäπÁéáÊÄßË©ï‰æ°
            let efficiency = 'D';
            if (utilizationRate > 80) efficiency = 'A';
            else if (utilizationRate > 60) efficiency = 'B';
            else if (utilizationRate > 40) efficiency = 'C';
            
            document.getElementById('efficiency').textContent = efficiency;
        }
        
        function exportToBlender() {
            let blenderCode = `import bpy
import bmesh

# Êó¢Â≠ò„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÂâäÈô§
bpy.ops.object.select_all(action='SELECT')
bpy.ops.object.delete(use_global=False)

# ÈÉ®Â±ã„ÅÆ‰ΩúÊàê
bpy.ops.mesh.primitive_cube_add(size=2, location=(0, 0, ${roomHeight/2}))
room = bpy.context.active_object
room.scale = (${roomWidth/2}, ${roomDepth/2}, ${roomHeight/2})
room.name = "Room"

# Â∫ä„Éû„ÉÜ„É™„Ç¢„É´
floor_material = bpy.data.materials.new(name="Floor")
floor_material.use_nodes = True
floor_material.node_tree.nodes["Principled BSDF"].inputs[0].default_value = (0.87, 0.72, 0.53, 1.0)
room.data.materials.append(floor_material)

`;

            furniture.forEach((item, index) => {
                const def = furnitureDefinitions[item.userData.type];
                const pos = item.position;
                blenderCode += `
# ${def.name}
bpy.ops.mesh.primitive_cube_add(location=(${pos.x.toFixed(2)}, ${pos.z.toFixed(2)}, ${(def.height/2).toFixed(2)}))
${item.userData.type}_${index} = bpy.context.active_object
${item.userData.type}_${index}.scale = (${(def.width/2).toFixed(2)}, ${(def.depth/2).toFixed(2)}, ${(def.height/2).toFixed(2)})
${item.userData.type}_${index}.name = "${def.name}_${index}"
`;
            });
            
            blenderCode += `
print("ÈÉ®Â±ã„ÅÆ3D„É¢„Éá„É´„Åå‰ΩúÊàê„Åï„Çå„Åæ„Åó„ÅüÔºÅ")
`;
            
            // „ÉÜ„Ç≠„Çπ„Éà„Éï„Ç°„Ç§„É´„Å®„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
            const blob = new Blob([blenderCode], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'room_layout.py';
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Blender„Ç≥„Éº„Éâ„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„ÅüÔºÅ');
        }
        
        function saveLayout() {
            const layoutData = {
                room: { width: roomWidth, depth: roomDepth, height: roomHeight },
                furniture: furniture.map(item => ({
                    type: item.userData.type,
                    position: item.position,
                    name: item.userData.name
                }))
            };
            
            const blob = new Blob([JSON.stringify(layoutData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'room_layout.json';
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('„É¨„Ç§„Ç¢„Ç¶„Éà„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
        }
        
        function takeScreenshot() {
            const canvas = document.getElementById('roomViewer');
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'room_screenshot.png';
                a.click();
                URL.revokeObjectURL(url);
                showNotification('„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
            });
        }
        
        function resetCamera() {
            camera.position.set(5, 4, 5);
            camera.lookAt(0, 0, 0);
            showNotification('„Ç´„É°„É©Ë¶ñÁÇπ„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
        }
        
        function toggleWireframe() {
            showWireframe = !showWireframe;
            furniture.forEach(item => {
                item.material.wireframe = showWireframe;
            });
            if (room) {
                room.children.forEach(child => {
                    if (child.material) child.material.wireframe = showWireframe;
                });
            }
            showNotification(showWireframe ? '„ÉØ„Ç§„É§„Éº„Éï„É¨„Éº„É†Ë°®Á§∫ON' : '„ÉØ„Ç§„É§„Éº„Éï„É¨„Éº„É†Ë°®Á§∫OFF');
        }
        
        function toggleGrid() {
            showGrid = !showGrid;
            const grid = scene.getObjectByName('grid');
            if (grid) grid.visible = showGrid;
            showNotification(showGrid ? '„Ç∞„É™„ÉÉ„ÉâË°®Á§∫ON' : '„Ç∞„É™„ÉÉ„ÉâË°®Á§∫OFF');
        }
        
        function analyzeSpace() {
            showLoading(true);
            setTimeout(() => {
                updateStats();
                showLoading(false);
                showNotification('Á©∫ÈñìÂàÜÊûê„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
            }, 1500);
        }
        
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function showLoading(show) {
            document.getElementById('loadingIndicator').style.display = show ? 'block' : 'none';
        }
        
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        
        // „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫ÂØæÂøú
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('roomViewer');
            camera.aspect = canvas.clientWidth / canvas.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        });
        
        // ÂàùÊúüÁµ±Ë®àÊõ¥Êñ∞
        updateStats();
    </script>
</body>
</html>