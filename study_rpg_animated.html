<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á≠ëÊ≥¢Â§ßÂ≠¶ÂêàÊ†ºRPG - 81„Çπ„ÉÜ„Éº„Ç∏„Éû„ÉÉ„Éó</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: auto;
        }

        .rpg-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .title {
            text-align: center;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 30px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 2px 2px 4px rgba(0,0,0,0.5), 0 0 10px #ffff00; }
            to { text-shadow: 2px 2px 4px rgba(0,0,0,0.5), 0 0 20px #ffff00, 0 0 30px #ffff00; }
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            height: 30px;
            margin: 20px 0;
            overflow: hidden;
            border: 2px solid #fff;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A, #CDDC39);
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 18px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .world-container {
            margin: 30px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            animation: worldAppear 0.6s ease-out;
        }

        @keyframes worldAppear {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .world-title {
            font-size: 24px;
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        .stages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stage {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #fff;
            position: relative;
            overflow: hidden;
        }

        .stage.completed {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            animation: completed-pulse 2s infinite;
        }

        @keyframes completed-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 10px rgba(76, 175, 80, 0.5); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(76, 175, 80, 0.8); }
        }

        .stage.current {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            animation: current-glow 1.5s ease-in-out infinite alternate;
        }

        @keyframes current-glow {
            from { box-shadow: 0 0 15px #FFD700; }
            to { box-shadow: 0 0 25px #FFD700, 0 0 35px #FFA500; }
        }

        .stage.locked {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            opacity: 0.6;
            cursor: not-allowed;
        }

        .stage:hover:not(.locked) {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .stage-number {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .stage-name {
            font-size: 14px;
            color: #fff;
            margin: 5px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .stage-icon {
            font-size: 30px;
            margin: 10px 0;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .boss-stage {
            background: linear-gradient(135deg, #8e44ad, #9b59b6) !important;
            border: 5px solid #f39c12 !important;
            animation: boss-pulse 2s ease-in-out infinite;
        }

        @keyframes boss-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .final-boss {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
            border: 5px solid #f1c40f !important;
            font-size: 18px !important;
            animation: final-boss-epic 3s ease-in-out infinite;
        }

        @keyframes final-boss-epic {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 20px #e74c3c; 
            }
            33% { 
                transform: scale(1.1); 
                box-shadow: 0 0 30px #e74c3c, 0 0 40px #f1c40f; 
            }
            66% { 
                transform: scale(1.05); 
                box-shadow: 0 0 25px #e74c3c, 0 0 35px #f1c40f; 
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 80%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            border: 3px solid #fff;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            animation: modalSlideIn 0.4s ease;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            color: #fff;
            float: right;
            font-size: 36px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #f39c12;
            text-shadow: 0 0 10px #f39c12;
        }

        .modal h2 {
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .modal-section {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid #f39c12;
        }

        .modal-section h3 {
            color: #f39c12;
            margin-bottom: 10px;
        }

        .modal-section p, .modal-section li {
            color: #fff;
            line-height: 1.6;
        }

        .complete-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .complete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .stats-panel {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            color: #fff;
            font-size: 18px;
        }

        .stat-value {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .level-up-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #fff;
            padding: 30px 50px;
            border-radius: 20px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            z-index: 2000;
            animation: levelUp 2s ease-in-out;
            border: 5px solid #fff;
            box-shadow: 0 0 30px rgba(243, 156, 18, 0.8);
        }

        @keyframes levelUp {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        .world-icons {
            display: inline-block;
            margin-right: 10px;
            font-size: 28px;
        }

        .download-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        @media (max-width: 768px) {
            .stages-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
            }
            
            .modal-content {
                width: 95%;
                margin: 2% auto;
                padding: 20px;
            }
            
            .stage {
                padding: 10px;
            }
            
            .stage-icon {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <button class="download-btn" onclick="downloadHTML()">üì• HTML„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
    
    <div class="rpg-container">
        <h1 class="title">üéÆ Á≠ëÊ≥¢Â§ßÂ≠¶ÂêàÊ†ºRPG - 81„Çπ„ÉÜ„Éº„Ç∏„Éû„ÉÉ„Éó üéØ</h1>
        
        <div class="stats-panel">
            <div class="stat-item">
                <span>üèÜ Á∑èÈÄ≤ÊçóÁéá</span>
                <span class="stat-value" id="overallProgress">0%</span>
            </div>
            <div class="stat-item">
                <span>‚≠ê ÁèæÂú®„É¨„Éô„É´</span>
                <span class="stat-value" id="currentLevel">1</span>
            </div>
            <div class="stat-item">
                <span>üéØ ÂÆå‰∫Ü„Çπ„ÉÜ„Éº„Ç∏</span>
                <span class="stat-value" id="completedStages">0/81</span>
            </div>
            <div class="stat-item">
                <span>üëë ÊíÉÁ†¥„Éú„Çπ</span>
                <span class="stat-value" id="defeatedBosses">0/12</span>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div id="worldsContainer"></div>
    </div>

    <!-- „É¢„Éº„ÉÄ„É´ -->
    <div id="stageModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // „Ç≤„Éº„É†„Éá„Éº„Çø
        const gameData = {
            worlds: [
                {
                    id: 1,
                    name: "Âü∫Á§éÂäõÈ§äÊàêÂüé",
                    icon: "üè∞",
                    theme: "Â≠¶ÁøíÁøíÊÖ£„Å®„Éô„Éº„Çπ‰Ωú„Çä",
                    stages: [
                        { id: "1-1", name: "ÂãáËÄÖ„ÅÆÁõÆË¶ö„ÇÅ", icon: "‚öîÔ∏è", mission: "1Êó•15ÂàÜÂãâÂº∑Á∂ôÁ∂ö", content: "„Çø„Ç§„Éû„Éº„Çí15ÂàÜ„Çª„ÉÉ„Éà„ÄÅÁ≠ëÊ≥¢Â§ßÂ≠¶„ÅÆÂãüÈõÜË¶ÅÈ†Ö„ÇíÂç∞Âà∑„Åó„Å¶ÁÜüË™≠„ÄÅÂèóÈ®ìÁßëÁõÆ„Å®ÈÖçÁÇπ„ÇíÊâãÊõ∏„Åç„Åß„Åæ„Å®„ÇÅ„Çã„ÄÅÂãâÂº∑„É≠„Ç∞„Ç∑„Éº„Éà„Çí‰ΩúÊàê„ÅóË®òÂÖ•ÈñãÂßã", clearCondition: "‰∏äË®ò4È†ÖÁõÆ„Çí3Êó•ÈÄ£Á∂öÂÆüË°å" },
                        { id: "1-2", name: "ÊôÇÈñì„ÅÆÈ≠îÊ≥ï‰Ωø„ÅÑ", icon: "‚è∞", mission: "ÂãâÂº∑ÊôÇÈñì„Çí30ÂàÜ„Å´Âª∂Èï∑√ó3Êó•", content: "„Éù„É¢„Éâ„Éº„É≠„Çø„Ç§„Éû„ÉºÔºà25ÂàÜÂãâÂº∑+5ÂàÜ‰ºëÊÜ©Ôºâ„ÇíÂ∞éÂÖ•„ÄÅ‰ºëÊÜ©ÊôÇÈñì„ÅÆ„É´„Éº„É´Ë®≠ÂÆö„ÄÅ30ÂàÜÈñì„ÅÆÈõÜ‰∏≠Â∫¶„Çí10ÊÆµÈöé„ÅßË®òÈå≤„ÄÅÈõÜ‰∏≠„ÅåÂàá„Çå„Åü„Çø„Ç§„Éü„É≥„Ç∞„Å®ÂéüÂõ†„Çí„É°„É¢„ÄÅÊúÄÈÅ©„Å™ÂãâÂº∑ÈñãÂßãÊôÇÈñì„Çí3„Éë„Çø„Éº„É≥Ë©¶Ë°å", clearCondition: "30ÂàÜ√ó3Êó•ÈÄ£Á∂öÈÅîÊàê„ÄÅÈõÜ‰∏≠Â∫¶Âπ≥Âùá7‰ª•‰∏äÁ∂≠ÊåÅ" },
                        { id: "1-3", name: "ÈõÜ‰∏≠„ÅÆÂÆàË≠∑ËÄÖ", icon: "üõ°Ô∏è", mission: "„Çπ„Éû„Éõ„ÇíÂà•ÈÉ®Â±ã„Å´ÁΩÆ„ÅÑ„Å¶ÂãâÂº∑", content: "ÂãâÂº∑ÈÉ®Â±ã„Åã„Çâ„Çπ„Éû„Éõ„Éª„Çø„Éñ„É¨„ÉÉ„ÉàÂÆåÂÖ®Èô§Âéª„ÄÅÈõÜ‰∏≠ÈòªÂÆ≥Ë¶ÅÂõ†„É™„Çπ„Éà10È†ÖÁõÆ‰ΩúÊàê„ÄÅÂêÑÈòªÂÆ≥Ë¶ÅÂõ†„Å∏„ÅÆÂØæÂá¶Ê≥ï„ÇíÂÖ∑‰ΩìÂåñ„ÄÅÈõÜ‰∏≠Â∫¶Ê∏¨ÂÆö„ÄÅ„ÄåÈõÜ‰∏≠ÂÑÄÂºè„Äç„ÅÆÁ¢∫Á´ã", clearCondition: "„Çπ„Éû„ÉõÂàÜÈõ¢ÂãâÂº∑„Çí5Êó•ÈÄ£Á∂öÂÆüË°å„ÄÅÊ∞ó„ÅåÊï£„ÇãÂõûÊï∞„Çí50%‰ª•‰∏ã„Å´ÂâäÊ∏õ" },
                        { id: "1-4", name: "Ë®àÁîªÁ´ãÊ°àÂ∏´", icon: "üìã", mission: "1ÈÄ±Èñì„ÅÆÂ≠¶ÁøíË®àÁîª„ÇíÁ´ã„Å¶„Çã", content: "Á≠ëÊ≥¢Â§ßÂ≠¶„ÅÆË©¶È®ìÊó•„Åã„ÇâÈÄÜÁÆó„Åó„Åü„Çπ„Ç±„Ç∏„É•„Éº„É´Ë°®‰ΩúÊàê„ÄÅÈÄ±ÈñìË®àÁîª„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíA4Áî®Á¥ô„Å´„Éá„Ç∂„Ç§„É≥„ÄÅÂêÑÁßëÁõÆ„ÅÆÂÑ™ÂÖàÂ∫¶„Çí5ÊÆµÈöéË©ï‰æ°„ÅßË®≠ÂÆö", clearCondition: "1ÈÄ±ÈñìË®àÁîª„ÅÆÂÆåÂÖ®ÂÆüË°åÔºàÈÅîÊàêÁéá80%‰ª•‰∏äÔºâ" },
                        { id: "1-5", name: "ÁøíÊÖ£„ÅÆÈå¨ÈáëË°ìÂ∏´", icon: "üß™", mission: "ÊØéÊó•Âêå„ÅòÊôÇÈñì„Å´ÂãâÂº∑ÈñãÂßã√ó5Êó•", content: "ÊúÄÈÅ©ÂãâÂº∑ÈñãÂßãÊôÇÂàª„ÇíÂàÜÂçò‰Ωç„ÅßÂõ∫ÂÆö„ÄÅÈñãÂßãÂâç30ÂàÜ„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥„Çí5„Çπ„ÉÜ„ÉÉ„Éó„ÅßË®≠Ë®à„ÄÅÂãâÂº∑ÈñãÂßã„ÅÆ„Äå„Éà„É™„Ç¨„Éº„Äç„ÇíÁí∞Â¢É„Å´Ë®≠ÁΩÆ", clearCondition: "Ë®≠ÂÆöÊôÇÂàª„ÅÆ¬±5ÂàÜ‰ª•ÂÜÖ„ÅßÈñãÂßã„Çí5Êó•ÈÄ£Á∂ö" },
                        { id: "1-6", name: "Ë®òÈå≤„ÅÆÂè≤ÂÆò", icon: "üìù", mission: "Â≠¶ÁøíÂÜÖÂÆπ„ÇíË®òÈå≤√ó7Êó•", content: "Â≠¶Áøí„É≠„Ç∞„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Çí‰ΩúÊàê„ÄÅËâ≤„Éö„É≥„ÅßÁêÜËß£Â∫¶„ÇíË¶ñË¶öÂåñ„ÄÅ„Åù„ÅÆÊó•ÊúÄ„ÇÇÁêÜËß£„ÅåÈÄ≤„Çì„Å†„Éù„Ç§„É≥„Éà„Çí1„Å§Ë®òÈå≤„ÄÅ„Å§„Åæ„Åö„ÅÑ„ÅüÁÆáÊâÄ„Å®„Åù„ÅÆÂéüÂõ†„ÇíÂÖ∑‰ΩìÁöÑ„Å´Ë®òËø∞", clearCondition: "7Êó•ÈñìÈÄ£Á∂ö„Åß„É≠„Ç∞Ë®òÈå≤ÂÆå‰∫Ü„ÄÅÁêÜËß£Â∫¶„ÅÆÊé®Áßª„Ç∞„É©„Éï„Çí‰ΩúÊàê" },
                        { id: "1-7", name: "Âæ©Áøí„ÅÆË≥¢ËÄÖ", icon: "üîÑ", mission: "ÂâçÊó•„ÅÆÂÜÖÂÆπ„ÇíÂæ©Áøí√ó3Êó•", content: "„Ç®„Éì„É≥„Ç∞„Éè„Ç¶„ÇπÂøòÂç¥Êõ≤Á∑ö„Å´Âü∫„Å•„ÅèÂæ©Áøí„Çπ„Ç±„Ç∏„É•„Éº„É´‰ΩúÊàê„ÄÅÂâçÊó•Â≠¶ÁøíÂÜÖÂÆπ„ÅÆË¶ÅÁÇπ„Çí3ÂàÜ„ÅßÂè£È†≠Ë™¨Êòé„ÄÅÂæ©ÁøíÂ∞ÇÁî®„Éé„Éº„Éà‰ΩúÊàê", clearCondition: "3Êó•ÈÄ£Á∂ö„ÅßÂæ©ÁøíÂÆüË°å„ÄÅÂè£È†≠Ë™¨Êòé„Åß70%‰ª•‰∏ä„ÅÆÂÜÖÂÆπÂÜçÁèæ" },
                        { id: "1-8", name: "Á∂ôÁ∂ö„ÅÆÊà¶Â£´", icon: "üí™", mission: "2ÈÄ±ÈñìÈÄ£Á∂öÂ≠¶ÁøíÈÅîÊàê", content: "ÊØéÊó•„ÅÆÂ≠¶ÁøíÊôÇÈñì„ÇíÁ¥ØÁ©ç„Ç∞„É©„ÉïÂåñ„ÄÅ„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥‰Ωé‰∏ãÊó•„ÅÆÂØæÂá¶Ê≥ï„Çí5„Å§Ê∫ñÂÇô„ÄÅ„Äå„ÇÑ„ÇãÊ∞ó„Çº„É≠„ÅÆÊó•„Äç„Åß„ÇÇÂÆüË°å„Åß„Åç„Çã„Éü„Éã„Éû„É´Ë™≤È°åË®≠ÂÆö", clearCondition: "14Êó•ÈñìÂ≠¶ÁøíÁ∂ôÁ∂öÔºà1Êó•ÊúÄ‰Ωé15ÂàÜ‰ª•‰∏äÔºâ" },
                        { id: "1-9", name: "Âü∫Á§éÂäõ„ÅÆÁï™‰∫∫", icon: "üëπ", mission: "Âü∫Á§éÂ≠¶ÂäõË®∫Êñ≠„ÉÜ„Çπ„ÉàÂÆüÊñΩ", content: "Á≠ëÊ≥¢Â§ßÂ≠¶„ÅÆÈÅéÂéªÂïè„Åã„ÇâÂü∫Á§éÂïèÈ°å„Çí30ÂïèÈÅ∏ÂÆö„ÄÅÂà∂ÈôêÊôÇÈñìÂÜÖ„Åß„ÅÆÂÆüÂäõÊ∏¨ÂÆö„ÉÜ„Çπ„ÉàÂÆüË°å„ÄÅÂàÜÈáéÂà•Ê≠£Á≠îÁéá„ÇíÂÜÜ„Ç∞„É©„Éï„ÅßË¶ñË¶öÂåñ", clearCondition: "Ë®∫Êñ≠„ÉÜ„Çπ„Éà60%‰ª•‰∏äÊ≠£Á≠î", isBoss: true }
                    ]
                },
                {
                    id: 2,
                    name: "Â∞ÇÈñÄÁü•Ë≠ò„ÅÆÊ£Æ",
                    icon: "üå≤",
                    theme: "Â∞ÇÈñÄÁßëÁõÆ„ÅÆÂü∫Á§éÂõ∫„ÇÅ",
                    stages: [
                        { id: "2-1", name: "ÊïôÁßëÊõ∏„ÅÆÊé¢Ê§úÂÆ∂", icon: "üìö", mission: "Â∞ÇÈñÄÁßëÁõÆÊïôÁßëÊõ∏„ÅÆÁõÆÊ¨°„ÇíÊääÊè°", content: "Á≠ëÊ≥¢Â§ßÂ≠¶Êé®Â•®ÂèÇËÄÉÊõ∏„É™„Çπ„Éà„Åã„Çâ‰∏ªË¶Å3ÂÜäÈÅ∏ÂÆö„ÄÅÂêÑÊïôÁßëÊõ∏„ÅÆÁõÆÊ¨°„ÇíÊâãÊõ∏„Åç„Åß„Éû„Ç§„É≥„Éâ„Éû„ÉÉ„ÉóÂåñ„ÄÅÁ´†Èñì„ÅÆÈñ¢ÈÄ£ÊÄß„ÇíÁü¢Âç∞„Å®Ëâ≤ÂàÜ„Åë„ÅßË°®Á§∫", clearCondition: "3ÂÜä„ÅÆÁõÆÊ¨°„Éû„ÉÉ„ÉóÂÆåÊàê" },
                        { id: "2-2", name: "Áî®Ë™ûÈõÜ„ÅÆÁ∑®Á∫ÇËÄÖ", icon: "üìñ", mission: "ÈáçË¶ÅÁî®Ë™û20ÂÄã„Çí„Ç´„Éº„ÉâÂåñ", content: "Â∞ÇÈñÄÂàÜÈáé„ÅÆÂü∫Á§éÁî®Ë™û50ÂÄã„Çí„É™„Çπ„Éà„Ç¢„ÉÉ„Éó„ÄÅ„Åù„ÅÆ‰∏≠„Åã„ÇâÊúÄÈáçË¶Å20ÂÄã„ÇíÂé≥ÈÅ∏„ÄÅÂçòË™û„Ç´„Éº„Éâ‰ΩúÊàê„ÄÅÈñ¢ÈÄ£Áî®Ë™ûÂêåÂ£´„ÇíËâ≤ÂàÜ„Åë„Åß„Ç∞„É´„Éº„ÉóÂåñ", clearCondition: "20Êûö„ÅÆÁî®Ë™û„Ç´„Éº„ÉâÂÆåÊàê„ÄÅ„É©„É≥„ÉÄ„É†Âá∫È°å„Åß90%Ê≠£Á≠îÈÅîÊàê" },
                        { id: "2-3", name: "Âõ≥Ëß£„ÅÆËä∏Ë°ìÂÆ∂", icon: "üé®", mission: "Ë§áÈõë„Å™Ê¶ÇÂøµ„Çí3„Å§Âõ≥Ëß£Âåñ", content: "Â∞ÇÈñÄÂàÜÈáé„ÅÆË§áÈõë„Å™ÁêÜË´ñ3„Å§„ÇíÈÅ∏ÂÆö„ÄÅÂêÑÁêÜË´ñ„ÇíA4Áî®Á¥ô1Êûö„Å´Âõ≥Ëß£ÔºàËâ≤„Éö„É≥4Ëâ≤‰ª•‰∏ä‰ΩøÁî®Ôºâ„ÄÅÂõ≥Ëß£„Å´„ÅØÁü¢Âç∞„ÉªÂêπ„ÅçÂá∫„Åó„Éª„Ç¢„Ç§„Ç≥„É≥„ÇíÊ¥ªÁî®", clearCondition: "3„Å§„ÅÆÁêÜË´ñÂõ≥Ëß£ÂÆåÊàê„ÄÅÂêÑÂõ≥Ëß£„ÅÆÁôΩÁ¥ôÂÜçÁèæ„ÉÜ„Çπ„Éà80%‰ª•‰∏äÂÜçÁèæ" },
                        { id: "2-4", name: "‰æãÈ°å„ÅÆËß£Ë™≠ËÄÖ", icon: "üîç", mission: "Âü∫Êú¨‰æãÈ°å„Çí10ÂïèËß£„Åè", content: "ÊïôÁßëÊõ∏„Åã„ÇâÂü∫Êú¨‰æãÈ°å10Âïè„ÇíÂé≥ÈÅ∏„ÄÅÂêÑÂïèÈ°å„ÅÆËß£Ê≥ï„Éó„É≠„Çª„Çπ„Çí7„Çπ„ÉÜ„ÉÉ„Éó„Å´ÂàÜËß£„ÄÅËß£Ê≥ï„ÅÆ„Äå„Å™„Åú„Åù„ÅÜ„Åô„Çã„ÅÆ„Åã„Äç„ÇíË®ÄË™ûÂåñ", clearCondition: "10Âïè„Åô„Åπ„Å¶ÂÆåÂÖ®Ëß£Á≠î" },
                        { id: "2-5", name: "Ë≥™Âïè„ÅÆÈ≠îÂ∞éÂ∏´", icon: "‚ùì", mission: "„Çè„Åã„Çâ„Å™„ÅÑÁÇπ„Çí5„Å§ÊòéÁ¢∫Âåñ", content: "Â≠¶Áøí‰∏≠„ÅÆÁñëÂïèÁÇπ„ÇíÂç≥Â∫ß„Å´„É°„É¢„Åô„ÇãÁøíÊÖ£Á¢∫Á´ã„ÄÅÁñëÂïè„Çí„ÄåÊ¶ÇÂøµ„ÉªË®àÁÆó„ÉªÂøúÁî®„Äç„ÅÆ3Á®ÆÈ°û„Å´ÂàÜÈ°û„ÄÅÂêÑÁñëÂïè„Å´„Å§„ÅÑ„Å¶„Äå‰Ωï„Åå„Çè„Åã„Çâ„Å™„ÅÑ„ÅÆ„Åã„Äç„ÇíÊñáÁ´†Âåñ", clearCondition: "5„Å§„ÅÆÊòéÁ¢∫„Å™ÁñëÂïèÊñáÂÆåÊàê„ÄÅÁñëÂïèËß£Ê±∫„Éó„É≠„Çª„Çπ5ÂõûÂÆüË°å" },
                        { id: "2-6", name: "Ë¶ÅÁ¥Ñ„ÅÆËÅ∑‰∫∫", icon: "‚úÇÔ∏è", mission: "1Á´†ÂàÜ„Çí1„Éö„Éº„Ç∏„Å´„Åæ„Å®„ÇÅ„Çã", content: "Â∞ÇÈñÄÊõ∏„ÅÆ1Á´†ÔºàÈÄöÂ∏∏20-30„Éö„Éº„Ç∏Ôºâ„ÇíÈÅ∏ÂÆö„ÄÅÈáçË¶Å„Éù„Ç§„É≥„Éà„ÇíÈöéÂ±§ÊßãÈÄ†„ÅßÊï¥ÁêÜ„ÄÅA4Áî®Á¥ô1Êûö„Å´„Éì„Ç∏„É•„Ç¢„É´Ë¶ÅÁ¥Ñ‰ΩúÊàê", clearCondition: "1„Éö„Éº„Ç∏Ë¶ÅÁ¥ÑÂÆåÊàê„ÄÅÂÜçÁèæ„ÉÜ„Çπ„Éà70%‰ª•‰∏äÈÅîÊàê" },
                        { id: "2-7", name: "Èñ¢ÈÄ£‰ªò„Åë„ÅÆË≥¢ËÄÖ", icon: "üîó", mission: "‰ªñÂàÜÈáé„Å®„ÅÆÈñ¢ÈÄ£ÊÄß„Çí3„Å§Áô∫Ë¶ã", content: "ÁèæÂú®Â≠¶Áøí‰∏≠„ÅÆÂ∞ÇÈñÄÂàÜÈáé„Å®‰ªñÂàÜÈáé„ÅÆÊé•ÁÇπÊé¢Á¥¢„ÄÅÂÖ∑‰ΩìÁöÑ„Å™Èñ¢ÈÄ£‰∫ã‰æã„Çí3„Å§‰ª•‰∏äÁô∫Ë¶ã„ÄÅÂêÑÈñ¢ÈÄ£ÊÄß„ÇíÂõ≥Ëß£„ÅßË°®Áèæ", clearCondition: "3„Å§„ÅÆÈñ¢ÈÄ£ÊÄßÁô∫Ë¶ã„Å®Âõ≥Ëß£Âåñ" },
                        { id: "2-8", name: "ÊºîÁøí„ÅÆÊà¶Â£´", icon: "‚öîÔ∏è", mission: "Á´†Êú´ÂïèÈ°å„ÇíÂÆåÂÖ®Âà∂Ë¶á", content: "ÈÅ∏ÂÆö„Åó„ÅüÁ´†„ÅÆÁ´†Êú´ÂïèÈ°å„Çí„Åô„Åπ„Å¶Ëß£Á≠î„ÄÅÈñìÈÅï„Åà„ÅüÂïèÈ°å„ÅÆÂéüÂõ†„ÇíÂàÜÈ°û„ÄÅÂêÑÈñìÈÅï„ÅÑ„Çø„Ç§„Éó„ÅÆÂØæÁ≠ñÊ≥ï„ÇíÂÖ∑‰ΩìÂåñ", clearCondition: "Á´†Êú´ÂïèÈ°åÊ≠£Á≠îÁéá95%‰ª•‰∏ä" },
                        { id: "2-9", name: "Â∞ÇÈñÄÁü•Ë≠ò„ÅÆÂÆàË≠∑Á•û", icon: "üêâ", mission: "Â∞ÇÈñÄÁßëÁõÆÊ®°Êì¨Ë©¶È®ì60%‰ª•‰∏ä", content: "Á≠ëÊ≥¢Â§ßÂ≠¶„ÅÆÈÅéÂéªÂïè„Åã„ÇâÂ∞ÇÈñÄÁßëÁõÆ50ÂïèÈÅ∏ÂÆö„ÄÅÊú¨Áï™ÂêåÊßò„ÅÆÊôÇÈñìÂà∂Èôê„ÅßÊ®°Êì¨Ë©¶È®ìÂÆüË°å„ÄÅÂàÜÈáéÂà•Ê≠£Á≠îÁéá„Çí„É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà„ÅßË¶ñË¶öÂåñ", clearCondition: "Ê®°Êì¨Ë©¶È®ì60%‰ª•‰∏äÂæóÁÇπ", isBoss: true }
                    ]
                },
                {
                    id: 3,
                    name: "Ëã±Ë™û„Çπ„Ç≠„É´„ÅÆÊµ∑",
                    icon: "üåä",
                    theme: "Ëã±Ë™ûÂäõÂº∑Âåñ",
                    stages: [
                        { id: "3-1", name: "ÂçòË™ûÂ∏≥„ÅÆÂÜíÈô∫ËÄÖ", icon: "üìî", mission: "Â≠¶Ë°ìËã±ÂçòË™û100ÂÄãÊöóË®ò", content: "Á≠ëÊ≥¢Â§ßÂ≠¶È†ªÂá∫ÂçòË™û„É™„Çπ„Éà„Åã„Çâ100Ë™ûÈÅ∏ÂÆö„ÄÅÂçòË™û„ÇíÂàÜÈáéÂà•Ôºà20Ë™û√ó5ÂàÜÈáéÔºâ„Å´„Ç∞„É´„Éº„ÉóÂåñ„ÄÅË¶ñË¶öÁöÑÊöóË®òÊ≥ï„ÇíÊ¥ªÁî®", clearCondition: "100Ë™û„ÅÆ„Çπ„Éö„É´„ÉÜ„Çπ„Éà95%Ê≠£Á≠î" },
                        { id: "3-2", name: "ÊñáÊ≥ï„ÅÆÂª∫ÁØâÂÆ∂", icon: "üèóÔ∏è", mission: "Â≠¶Ë°ìËã±Ë™û„ÅÆÊñáÊ≥ï„Éë„Çø„Éº„É≥ÁøíÂæó", content: "Ë´ñÊñá„Åß„Çà„Åè‰Ωø„Çè„Çå„ÇãÊñáÊ≥ïÊßãÈÄ†20„Éë„Çø„Éº„É≥ÈÅ∏ÂÆö„ÄÅÂêÑ„Éë„Çø„Éº„É≥„ÅÆ‰æãÊñá„Çí3„Å§„Åö„Å§‰ΩúÊàê„ÄÅÊñáÊ≥ïÊßãÈÄ†„ÇíË¶ñË¶öÁöÑ„Å´Âõ≥Ëß£", clearCondition: "20„Éë„Çø„Éº„É≥„ÅÆÊñáÊ≥ïÁøíÂæóÁ¢∫Ë™ç„ÉÜ„Çπ„Éà90%Ê≠£Á≠î" },
                        { id: "3-3", name: "Ë™≠Ëß£„ÅÆËà™Êµ∑Â£´", icon: "üß≠", mission: "Â≠¶Ë°ìË´ñÊñá1Êú¨ÂÆåË™≠", content: "„ÅÇ„Å™„Åü„ÅÆÂ∞ÇÈñÄÂàÜÈáé„ÅÆËã±Ë™ûË´ñÊñáÔºà10„Éö„Éº„Ç∏‰ª•‰∏äÔºâ„Çí1Êú¨ÈÅ∏ÂÆö„ÄÅÊÆµËêΩ„Åî„Å®„ÅÆË¶ÅÊó®„ÇíÊó•Êú¨Ë™û„Åß1Êñá„Å´„Åæ„Å®„ÇÅ„ÄÅ‰∏çÊòéÂçòË™û„Çí„Åô„Åπ„Å¶Ë™ø„Åπ„Å¶Â∞ÇÁî®„Éé„Éº„Éà„Å´Ë®òÈå≤", clearCondition: "Ë´ñÊñá1Êú¨ÂÆåÂÖ®Ë™≠Á†¥„ÄÅÂÜÖÂÆπË¶ÅÁ¥Ñ„ÉÜ„Çπ„Éà80%Ê≠£Á≠î" },
                        { id: "3-4", name: "ÁøªË®≥„ÅÆÈå¨ÈáëË°ìÂ∏´", icon: "‚öóÔ∏è", mission: "Â∞ÇÈñÄÁî®Ë™û„ÅÆËã±Êó•ÂØæË®≥Ë°®‰ΩúÊàê", content: "Â∞ÇÈñÄÂàÜÈáé„ÅÆÈáçË¶ÅÁî®Ë™û50ÂÄã„ÇíËã±Êó•‰∏°Êñπ„ÅßÊï¥ÁêÜ„ÄÅÂêÑÁî®Ë™û„ÅÆ‰ΩøÁî®‰æãÊñá„ÇíËã±Ë™û„Åß3„Å§„Åö„Å§‰ΩúÊàê„ÄÅÈ°ûÁæ©Ë™û„ÉªÂØæÁæ©Ë™û„ÇÇÂê´„ÇÅ„ÅüÈñ¢ÈÄ£Ë™ûÂΩô„Éû„ÉÉ„Éó‰ΩúÊàê", clearCondition: "50Ë™û„ÅÆÂØæË®≥Ë°®ÂÆåÊàê„ÄÅÁû¨ÈñìÁøªË®≥„ÉÜ„Çπ„Éà85%Ê≠£Á≠î" },
                        { id: "3-5", name: "ËÅû„ÅçÂèñ„Çä„ÅÆÈ≠îÊ≥ï‰Ωø„ÅÑ", icon: "üëÇ", mission: "Â≠¶Ë°ìË¨õÁæ©ÂãïÁîª1Êú¨ÁêÜËß£", content: "YouTubeÁ≠â„ÅßËã±Ë™û„ÅÆÂ≠¶Ë°ìË¨õÁæ©ÂãïÁîªÔºà30ÂàÜ‰ª•‰∏äÔºâ„ÇíÈÅ∏ÂÆö„ÄÅÂ≠óÂπï„Å™„Åó„ÅßÂÜÖÂÆπÁêÜËß£Â∫¶„ÉÜ„Çπ„ÉàÂÆüË°å„ÄÅ„Ç∑„É£„Éâ„Éº„Ç§„É≥„Ç∞Á∑¥Áøí", clearCondition: "Ë¨õÁæ©ÂÜÖÂÆπÁêÜËß£Â∫¶70%‰ª•‰∏ä" },
                        { id: "3-6", name: "Ë¶ÅÁ¥Ñ„ÅÆË©©‰∫∫", icon: "üìú", mission: "Ëã±Ë™ûË´ñÊñá„ÇíÊó•Êú¨Ë™û„ÅßË¶ÅÁ¥Ñ", content: "Ëã±Ë™ûË´ñÊñáÔºà5-10„Éö„Éº„Ç∏Ôºâ„ÇíÈÅ∏ÂÆö„ÄÅË´ñÊñá„ÅÆÊßãÈÄ†„ÇíÊääÊè°„ÄÅÂêÑ„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆ„Ç≠„Éº„Éù„Ç§„É≥„Éà„ÇíËã±Ë™û„ÅßÊäú„ÅçÂá∫„Åó„ÄÅÂÖ®‰Ωì„ÇíÊó•Êú¨Ë™ûA4Áî®Á¥ô1Êûö„Å´Ë¶ÅÁ¥Ñ", clearCondition: "Ë¶ÅÁ¥ÑÂÆåÊàêÔºà1000Â≠ó‰ª•ÂÜÖÔºâ„ÄÅÂÜçÁèæ„ÉÜ„Çπ„Éà70%‰ª•‰∏ä" },
                        { id: "3-7", name: "Ë≠∞Ë´ñ„ÅÆÈ®éÂ£´", icon: "üèá", mission: "Ëã±Ë™û„ÅßÂ∞ÇÈñÄÁöÑË≠∞Ë´ñ„ÇíÁêÜËß£", content: "2022Âπ¥Â∫¶‰ª•Èôç„ÅÆËã±Ë™ûË´ñÊñá„Çí5Êú¨ÈÅ∏ÂÆö„ÄÅÂêÑË´ñÊñá„ÅÆÂèÇËÄÉÊñáÁåÆ„Åã„ÇâÂ∞ÇÈñÄÊñáÁåÆ„Çí2Êú¨„Åö„Å§ÈÅ∏Êäû„ÄÅÂêÑË´ñÊñá„ÅÆ„Ç¢„Éº„ÇÆ„É•„É°„É≥„ÉàÊßãÈÄ†„ÇíÂõ≥Ëß£Âåñ", clearCondition: "15Êú¨„ÅÆÊñáÁåÆË™≠Á†¥ÂÆå‰∫Ü„ÄÅ„Ç¢„Éº„ÇÆ„É•„É°„É≥„ÉàÂõ≥Ëß£5ÊûöÂÆåÊàê" },
                        { id: "3-8", name: "Ë°®Áèæ„ÅÆËä∏Ë°ìÂÆ∂", icon: "üé≠", mission: "Ëã±Ë™û„ÅßÂ∞ÇÈñÄÁü•Ë≠ò„ÇíË™¨Êòé", content: "Â∞ÇÈñÄÂàÜÈáé„ÅÆÂü∫Êú¨Ê¶ÇÂøµ„Çí5„Å§ÈÅ∏ÂÆö„ÄÅÂêÑÊ¶ÇÂøµ„ÇíËã±Ë™û„Åß3ÂàÜÈñì„Çπ„Éî„Éº„ÉÅ„Åß„Åç„Çã„Çà„ÅÜÊ∫ñÂÇô„ÄÅË™¨ÊòéÁî®„ÅÆË¶ñË¶öË≥áÊñô„ÇÇËã±Ë™û„Åß‰ΩúÊàê", clearCondition: "5Ê¶ÇÂøµ√ó3ÂàÜ„Çπ„Éî„Éº„ÉÅÂÆåÈÅÇ„ÄÅÁô∫Èü≥ÊòéÁû≠Â∫¶80%‰ª•‰∏ä" },
                        { id: "3-9", name: "Ëã±Ë™û„Éû„Çπ„Çø„Éº", icon: "üëë", mission: "Ëã±Ë™ûÊ®°Êì¨Ë©¶È®ì70%‰ª•‰∏ä", content: "Á≠ëÊ≥¢Â§ßÂ≠¶„ÅÆËã±Ë™ûÈÅéÂéªÂïè3Âπ¥ÂàÜ„ÇíÊôÇÈñìÂà∂Èôê„ÅßÂÆüË°å„ÄÅÈï∑ÊñáË™≠Ëß£„ÉªËã±‰ΩúÊñá„Éª„É™„Çπ„Éã„É≥„Ç∞„ÅÆÁ∑èÂêà„ÉÜ„Çπ„Éà„ÄÅÂàÜÈáéÂà•Ê≠£Á≠îÁéá„Çí„Ç∞„É©„ÉïÂåñ", clearCondition: "Ê®°Êì¨Ë©¶È®ì70%‰ª•‰∏äÂæóÁÇπ", isBoss: true }
                    ]
                }
            ],
            finalBoss: {
                name: "Á≠ëÊ≥¢Â§ßÂ≠¶ÂÖ•Â≠¶Ë©¶È®ì",
                phases: [
                    { name: "Á≠ÜË®òË©¶È®ìÔºàÂ∞ÇÈñÄÁßëÁõÆÔºâ", icon: "üìù" },
                    { name: "Âè£Ëø∞Ë©¶È®ì", icon: "üó£Ô∏è" },
                    { name: "Á≠ÜË®òË©¶È®ìÔºàËã±Ë™ûÔºâ", icon: "üåç" }
                ]
            }
        };

        // „Ç≤„Éº„É†Áä∂ÊÖã
        let gameState = {
            completedStages: new Set(),
            currentStage: "1-1",
            level: 1,
            defeatedBosses: 0
        };

        // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
        function loadGameState() {
            const saved = localStorage.getItem('tsukubaRPGState');
            if (saved) {
                const parsed = JSON.parse(saved);
                gameState.completedStages = new Set(parsed.completedStages || []);
                gameState.currentStage = parsed.currentStage || "1-1";
                gameState.level = parsed.level || 1;
                gameState.defeatedBosses = parsed.defeatedBosses || 0;
            }
        }

        // „Ç≤„Éº„É†Áä∂ÊÖã„Çí‰øùÂ≠ò
        function saveGameState() {
            const toSave = {
                completedStages: Array.from(gameState.completedStages),
                currentStage: gameState.currentStage,
                level: gameState.level,
                defeatedBosses: gameState.defeatedBosses
            };
            localStorage.setItem('tsukubaRPGState', JSON.stringify(toSave));
        }

        // Áµ±Ë®à„ÇíÊõ¥Êñ∞
        function updateStats() {
            const totalStages = gameData.worlds.reduce((sum, world) => sum + world.stages.length, 0);
            const completed = gameState.completedStages.size;
            const progressPercent = Math.round((completed / totalStages) * 100);
            
            document.getElementById('overallProgress').textContent = `${progressPercent}%`;
            document.getElementById('currentLevel').textContent = gameState.level;
            document.getElementById('completedStages').textContent = `${completed}/${totalStages}`;
            document.getElementById('defeatedBosses').textContent = `${gameState.defeatedBosses}/12`;
            
            // „Éó„É≠„Ç∞„É¨„Çπ„Éê„ÉºÊõ¥Êñ∞
            document.getElementById('progressFill').style.width = `${progressPercent}%`;
        }

        // „ÉØ„Éº„É´„Éâ„ÇíÁîüÊàê
        function createWorlds() {
            const container = document.getElementById('worldsContainer');
            
            gameData.worlds.forEach(world => {
                const worldDiv = document.createElement('div');
                worldDiv.className = 'world-container';
                worldDiv.style.animationDelay = `${world.id * 0.2}s`;
                
                const stagesGrid = document.createElement('div');
                stagesGrid.className = 'stages-grid';
                
                world.stages.forEach(stage => {
                    const stageDiv = document.createElement('div');
                    stageDiv.className = 'stage';
                    stageDiv.setAttribute('data-stage-id', stage.id);
                    
                    // „Çπ„ÉÜ„Éº„Ç∏„ÅÆÁä∂ÊÖã„ÇíÂà§ÂÆö
                    if (gameState.completedStages.has(stage.id)) {
                        stageDiv.classList.add('completed');
                    } else if (stage.id === gameState.currentStage || isStageUnlocked(stage.id)) {
                        if (stage.id === gameState.currentStage) {
                            stageDiv.classList.add('current');
                        }
                    } else {
                        stageDiv.classList.add('locked');
                    }
                    
                    if (stage.isBoss) {
                        stageDiv.classList.add('boss-stage');
                    }
                    
                    stageDiv.innerHTML = `
                        <div class="stage-icon">${stage.icon}</div>
                        <div class="stage-number">${stage.id}</div>
                        <div class="stage-name">${stage.name}</div>
                    `;
                    
                    stageDiv.addEventListener('click', () => openStageModal(stage));
                    stagesGrid.appendChild(stageDiv);
                });
                
                worldDiv.innerHTML = `
                    <h2 class="world-title">
                        <span class="world-icons">${world.icon}</span>
                        WORLD ${world.id}: ${world.name}
                    </h2>
                    <p style="text-align: center; color: #fff; margin-bottom: 20px; font-style: italic;">
                        ${world.theme}
                    </p>
                `;
                worldDiv.appendChild(stagesGrid);
                container.appendChild(worldDiv);
            });
            
            // „Éï„Ç°„Ç§„Éä„É´„Éú„ÇπËøΩÂä†
            const finalBossDiv = document.createElement('div');
            finalBossDiv.className = 'world-container';
            finalBossDiv.innerHTML = `
                <h2 class="world-title">
                    <span class="world-icons">üëë</span>
                    FINAL BOSS: ${gameData.finalBoss.name}
                </h2>
                <div class="stages-grid">
                    ${gameData.finalBoss.phases.map((phase, index) => `
                        <div class="stage final-boss" data-stage-id="final-${index + 1}">
                            <div class="stage-icon">${phase.icon}</div>
                            <div class="stage-number">Phase ${index + 1}</div>
                            <div class="stage-name">${phase.name}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            container.appendChild(finalBossDiv);
        }

        // „Çπ„ÉÜ„Éº„Ç∏„Åå„Ç¢„É≥„É≠„ÉÉ„ÇØ„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÂà§ÂÆö
        function isStageUnlocked(stageId) {
            const [world, stage] = stageId.split('-').map(Number);
            
            // 1-1„ÅØÂ∏∏„Å´„Ç¢„É≥„É≠„ÉÉ„ÇØ
            if (stageId === "1-1") return true;
            
            // Âêå„Åò„ÉØ„Éº„É´„Éâ„ÅÆÂâç„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„ÅåÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Çã
            if (stage > 1) {
                const prevStage = `${world}-${stage - 1}`;
                return gameState.completedStages.has(prevStage);
            }
            
            // Ââç„ÅÆ„ÉØ„Éº„É´„Éâ„ÅÆÊúÄÂæå„ÅÆ„Çπ„ÉÜ„Éº„Ç∏Ôºà„Éú„ÇπÔºâ„ÅåÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Çã
            if (world > 1) {
                const prevWorldBoss = `${world - 1}-9`;
                return gameState.completedStages.has(prevWorldBoss);
            }
            
            return false;
        }

        // „Çπ„ÉÜ„Éº„Ç∏„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function openStageModal(stage) {
            if (!isStageUnlocked(stage.id) && !gameState.completedStages.has(stage.id)) {
                return;
            }
            
            const modal = document.getElementById('stageModal');
            const modalContent = document.getElementById('modalContent');
            
            const isCompleted = gameState.completedStages.has(stage.id);
            const completeBtnText = isCompleted ? '‚úÖ ÂÆå‰∫ÜÊ∏à„Åø' : 'üéØ „Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢ÔºÅ';
            const completeBtnClass = isCompleted ? 'completed' : '';
            
            modalContent.innerHTML = `
                <h2>${stage.icon} ${stage.id}: ${stage.name}</h2>
                
                <div class="modal-section">
                    <h3>üéØ „Éü„ÉÉ„Ç∑„Éß„É≥</h3>
                    <p>${stage.mission}</p>
                </div>
                
                <div class="modal-section">
                    <h3>üìã ÂÖ∑‰ΩìÁöÑÂÜÖÂÆπ</h3>
                    <p>${stage.content}</p>
                </div>
                
                <div class="modal-section">
                    <h3>‚úÖ „ÇØ„É™„Ç¢Êù°‰ª∂</h3>
                    <p>${stage.clearCondition}</p>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="complete-btn ${completeBtnClass}" onclick="completeStage('${stage.id}')" ${isCompleted ? 'disabled' : ''}>
                        ${completeBtnText}
                    </button>
                    ${!isCompleted ? `<button class="complete-btn" onclick="resetStage('${stage.id}')" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">üîÑ „É™„Çª„ÉÉ„Éà</button>` : ''}
                </div>
            `;
            
            modal.style.display = 'block';
        }

        // „Çπ„ÉÜ„Éº„Ç∏„ÇíÂÆå‰∫Ü
        function completeStage(stageId) {
            if (gameState.completedStages.has(stageId)) return;
            
            gameState.completedStages.add(stageId);
            
            // „Éú„Çπ„Çπ„ÉÜ„Éº„Ç∏„ÅÆÂ†¥Âêà
            if (stageId.endsWith('-9')) {
                gameState.defeatedBosses++;
                showLevelUpAnimation(`üèÜ „Éú„ÇπÊíÉÁ†¥ÔºÅ\nWORLD ${stageId.split('-')[0]} „ÇØ„É™„Ç¢ÔºÅ`);
            } else {
                showLevelUpAnimation(`‚ú® „Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢ÔºÅ\n${stageId} ÂÆå‰∫ÜÔºÅ`);
            }
            
            // „É¨„Éô„É´„Ç¢„ÉÉ„ÉóÂà§ÂÆö
            const newLevel = Math.floor(gameState.completedStages.size / 9) + 1;
            if (newLevel > gameState.level) {
                gameState.level = newLevel;
                setTimeout(() => {
                    showLevelUpAnimation(`üéâ LEVEL UP!\n„É¨„Éô„É´ ${gameState.level} „Å´Âà∞ÈÅîÔºÅ`);
                }, 1000);
            }
            
            // Ê¨°„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„ÇíË®≠ÂÆö
            updateCurrentStage(stageId);
            
            saveGameState();
            updateStats();
            refreshDisplay();
            closeModal();
        }

        // ÁèæÂú®„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„ÇíÊõ¥Êñ∞
        function updateCurrentStage(completedStageId) {
            const [world, stage] = completedStageId.split('-').map(Number);
            
            // Âêå„Åò„ÉØ„Éº„É´„Éâ„ÅÆÊ¨°„ÅÆ„Çπ„ÉÜ„Éº„Ç∏
            if (stage < 9) {
                gameState.currentStage = `${world}-${stage + 1}`;
            } else {
                // Ê¨°„ÅÆ„ÉØ„Éº„É´„Éâ„ÅÆÊúÄÂàù„ÅÆ„Çπ„ÉÜ„Éº„Ç∏
                const nextWorld = world + 1;
                if (nextWorld <= gameData.worlds.length) {
                    gameState.currentStage = `${nextWorld}-1`;
                } else {
                    gameState.currentStage = "final-1";
                }
            }
        }

        // „Çπ„ÉÜ„Éº„Ç∏„Çí„É™„Çª„ÉÉ„Éà
        function resetStage(stageId) {
            gameState.completedStages.delete(stageId);
            gameState.currentStage = stageId;
            
            // „Éú„ÇπÊíÉÁ†¥Êï∞„ÇÇË™øÊï¥
            if (stageId.endsWith('-9')) {
                gameState.defeatedBosses = Math.max(0, gameState.defeatedBosses - 1);
            }
            
            saveGameState();
            updateStats();
            refreshDisplay();
            closeModal();
        }

        // „É¨„Éô„É´„Ç¢„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíË°®Á§∫
        function showLevelUpAnimation(text) {
            const animation = document.createElement('div');
            animation.className = 'level-up-animation';
            animation.innerHTML = text.replace('\n', '<br>');
            document.body.appendChild(animation);
            
            setTimeout(() => {
                document.body.removeChild(animation);
            }, 2000);
        }

        // Ë°®Á§∫„ÇíÊõ¥Êñ∞
        function refreshDisplay() {
            const container = document.getElementById('worldsContainer');
            container.innerHTML = '';
            createWorlds();
        }

        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeModal() {
            document.getElementById('stageModal').style.display = 'none';
        }

        // HTML„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
        function downloadHTML() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Á≠ëÊ≥¢Â§ßÂ≠¶ÂêàÊ†ºRPG_81„Çπ„ÉÜ„Éº„Ç∏„Éû„ÉÉ„Éó.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadGameState();
            createWorlds();
            updateStats();
            
            // „É¢„Éº„ÉÄ„É´„ÅÆ„ÇØ„É≠„Éº„Ç∫„Ç§„Éô„É≥„Éà
            document.querySelector('.close').addEventListener('click', closeModal);
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('stageModal');
                if (event.target === modal) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>